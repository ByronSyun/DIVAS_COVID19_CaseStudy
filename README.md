# DIVAS COVID-19 Case Study

üìä **[View the Interactive Case Study Website](https://byronsyun.github.io/DIVAS_COVID19_CaseStudy/)**

The interactive tutorial demonstrates DIVAS analysis using pre-computed results:
- Multi-omics data integration using DIVAS
- Component visualization and interpretation
- GO enrichment analysis
- Multi-omics correlation networks (Circos plots)

> **Note**: The tutorial focuses on DIVAS analysis and interpretation. For the complete data preprocessing pipeline (raw data download, quality control, cell type annotation, etc.), see the detailed instructions in the sections below.

---

## Overview

This repository contains a complete reproducible case study demonstrating the application of DIVAS (Data Integration via Analysis of Subspaces) to COVID-19 multi-omics data.

DIVAS is a novel statistical method for integrating multiple high-dimensional datasets. This case study applies DIVAS to COVID-19 patient data including:

- Single-cell RNA sequencing (scRNA-seq)
- Single-cell protein expression (CITE-seq) 
- Bulk proteomics
- Metabolomics

## Repository Structure

This repository is organized into 4 main analysis directories:

```
DIVAS_COVID19_CaseStudy/
‚îú‚îÄ‚îÄ üìÅ data_acquisition/             # Raw data download and organization
‚îÇ   ‚îú‚îÄ‚îÄ download_arrayexpress_data.sh   # Download scRNA-seq data
‚îÇ   ‚îú‚îÄ‚îÄ organize_arrayexpress_files.sh  # Organize downloaded files
‚îÇ   ‚îî‚îÄ‚îÄ mendeley_data/                   # Clinical metadata (manual download)
‚îú‚îÄ‚îÄ üìÅ preprocessing/                 # Data preprocessing pipeline
‚îÇ   ‚îú‚îÄ‚îÄ process_bulk/                    # Bulk omics processing
‚îÇ   ‚îú‚îÄ‚îÄ process_sc/                      # Single-cell processing  
‚îÇ   ‚îú‚îÄ‚îÄ data_alignment/                  # Cross-omics alignment
‚îÇ   ‚îî‚îÄ‚îÄ processed_omics_120/            # Final 120-patient datasets
‚îú‚îÄ‚îÄ üìÅ multi_omics_integration/      # 4-omics DIVAS analysis
‚îÇ   ‚îú‚îÄ‚îÄ run_divas_analysis.R            # Main integration script
‚îÇ   ‚îú‚îÄ‚îÄ Final_Inputs/                   # Pre-processed 4-omics data
‚îÇ   ‚îî‚îÄ‚îÄ DIVAS_Results/                  # Integration results
‚îî‚îÄ‚îÄ üìÅ scRNA_celltyist_analysis/     # Cell type-specific analysis
    ‚îú‚îÄ‚îÄ celltype_annotation/            # CellTypist annotation
    ‚îú‚îÄ‚îÄ T1T2_preparation/              # 6-block data preparation
    ‚îî‚îÄ‚îÄ DIVAS_run/                     # 6-block DIVAS analysis
```

Each directory contains a comprehensive `README.md` with detailed instructions.

## Key Features

- **Complete Workflow**: From raw data processing to final DIVAS analysis
- **Reproducible**: All scripts with updated paths and dependencies
- **Well-documented**: Comprehensive README files in each directory
- **Cell Type Analysis**: Integration with CellTypist for automated annotation
- **Multi-timepoint**: Analysis of T1 and T2 timepoints (114 samples)

## Getting Started

### Prerequisites

- R (>= 4.0) with DIVAS package
- Python (>= 3.8) with scanpy, pandas, celltypist
- Required R packages: devtools, CVXR
- Required Python packages: scanpy, celltypist, pandas, numpy

### Installation

1. Clone this repository:
```bash
git clone https://github.com/ByronSyun/DIVAS_COVID19_CaseStudy.git
cd DIVAS_COVID19_CaseStudy
```

2. Install DIVAS package:
```r
library(devtools)
install_github("ByronSyun/DIVAS_Develop/pkg", ref = "main")
```

3. Install Python dependencies:
```bash
pip install scanpy celltypist pandas numpy
```

### Usage

This case study follows a 4-phase workflow. Each phase has detailed instructions in its respective directory:

#### Phase 1: Data Acquisition
```bash
cd data_acquisition
# See data_acquisition/README.md for detailed instructions
bash download_arrayexpress_data.sh
```

#### Phase 2: Data Preprocessing  
```bash
cd preprocessing
# See preprocessing/README.md for complete pipeline
# Processes raw data ‚Üí 120-patient standardized datasets
```

#### Phase 3: Multi-omics Integration (4-block DIVAS)
```bash
cd multi_omics_integration
# See multi_omics_integration/README.md for analysis details
Rscript run_divas_analysis.R
```

#### Phase 4: Cell Type Analysis (6-block DIVAS)
```bash
cd scRNA_celltyist_analysis
# See scRNA_celltyist_analysis/README.md for complete workflow
# Includes: CellTypist annotation ‚Üí T1+T2 preparation ‚Üí DIVAS analysis
```

> üí° **Tip**: Each directory contains a comprehensive `README.md` with detailed step-by-step instructions, troubleshooting guides, and expected outputs.

## Data Requirements

‚ö†Ô∏è **Important**: This repository contains code and documentation only. Large data files are excluded from Git and must be generated by running the preprocessing scripts on your raw data.

Required input data (not included):
- Raw scRNA-seq data (.h5ad format)
- Bulk proteomics data
- Metabolomics data  
- Sample metadata

Generated data directories (empty in Git):
- `preprocessing/processed_omics_120/`
- `preprocessing/processed_omics_all/`
- `scRNA_celltyist_analysis/celltype_annotation/annotated_data_majority_voting/`
- `multi_omics_integration/DIVAS_Results/`
- `scRNA_celltyist_analysis/DIVAS_run/divas_results/`

## Key Results

### 4-omics Integration
- Integrates scRNA-seq, sc-proteomics, bulk proteomics, and metabolomics
- 120 samples across two timepoints
- Identifies joint and individual variation patterns

### 6-block Cell Type Analysis  
- 114 samples (57 T1 + 57 T2)
- 4 cell types: CD4+ T, CD8+ T, CD14+ Monocytes, NK cells
- 2 bulk omics: proteomics, metabolomics
- 8,634 genes with comprehensive joint component analysis

## Citation

If you use this code or methodology, please cite:

```
Prothero, J., ..., Marron J. S. (2024). 
Data integration via analysis of subspaces (DIVAS).
```

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Contact

For questions about this case study, please contact:
- Byron Sun: [contact information]
- Issues: https://github.com/ByronSyun/DIVAS_COVID19_CaseStudy/issues

## Acknowledgments

- DIVAS development team
- COVID-19 data contributors
- CellTypist development team
